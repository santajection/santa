# サンタジェクション
サンタが壁を登ります！

## コンセプト
今日はクリスマス．

子どもたちとってはとってもとっても大事な日．

みんなサンタさんからプレゼントを貰うのを楽しみに待っている．

それなのにうっかり者のサンタさん達はお寝坊しちゃったみたい．

みんな，お寝坊なサンタを応援してサンタさんを壁の上のソリまで連れって行ってあげよう！！

## 開発

### 環境
- Chrome
- Node.js
- [hub](https://github.com/santajection/hub)

### リポジトリのクローン

```
git clone git@github.com:santajection/santa.git
```

### 設定
[hub](https://github.com/santajection/hub)のURLを`config.default.json`に書き込む。
デフォルトではlocalhost:3001(hubの初期値)に設定されている。
```
{
  "hubserver": "localhost:3001"
}
```

### パッケージインストール

```
cd santa
npm install
```

 ### 起動
注：hubが起動されていて接続できる状態にあること。
```
npm start
```

## 運営
### URL
`localhost:3000`を設定したhubのURLと読み替える。
- ゲーム画面: http://localhost:3000
- 運営画面： http://localhost:3000

### ルール
- 時間は30秒
- スマホを振ってサンタを登らせる
- 途中で出て来るトナカイにぶつかると落ちちゃうから避けてね

### 運営画面
`http://localhost:3000/unnei`の各項目を説明する。

#### サンタコントローラー
- q、w、e、rを押すと、赤、青、黄、緑の各サンタが一定確率で登る。下手な人はこれでサポートしてあげる

#### ゲームの進行
- ボタンを押すと画面が切り替わる
- タイトルや、ルールの説明など進行に合わせて切り替える
- ゲームを始める前に「初期状態」にして、「ゲームスタート」をしてゲームを開始する

#### 状態変更
- 複数回ゲームをするときに、各ゲームにはゲームidを設定する
- ゲームid毎にユーザーがアクセスするURLも違う
- 今から始めるゲームidを記入し、ゲーム受付開始ボタンを押す
- そうするとユーザーは（スマホから）参加できる状態になる
- モバイルにメッセージを送るは未実装

#### 開発用コマンド
本番のときには必要なし。
ゲーム内容のプレゼンや、ゲームの簡単な動作確認に使う。

- 強制時間切れ：ゲーム途中でも、強制的に時間切れにし、ゲームエンディングアニメーションを表示させる
- サンタ追加、画面が「初期状態」にあるとき、ダミーのサンタをゲーム画面に追加する
- 他は未実装

#### サンタの名前
- 登場シーンの確認をする
- テキストボックスに名前を入れて、登場ボタンを押すと入力された名前が表示されたサンタが登場してくる



### 補足
運営画面でQWERのキーを連打するとそれぞれ赤青黄緑のサンタが登ります．
スマホが足りなかったら運営画面からゲームに参加して下さい．

## ローカルサーバーの立ち上げ方
### サーバを起動
node app.js

### js/config.js
ゲーム画面PCのIPアドレスを設定

var SERVER = "http://xxx.xxx.xxx.xxx:3000";

### ネットワーク
ローカルサーバーで遊ぶ場合は，ゲーム画面，管理画面，コントローラ画面の各端末が同じネットワークに属するようにする．
同じwifiに接続すればとりあえずOK．

以下のページを開く

- ゲーム画面 http://xxx.xxx.xxx.xxx:3000/index.html
- 管理画面 http://xxx.xxx.xxx.xxx:3000/unnei.html
- コントローラー画面 http://xxx.xxx.xxx.xxx:3000/shake.html

### 遊び方
デモの説明と同じ

## 注意事項
- ゲーム画面のロードには画像10MBほどダウンロードします．環境によっては時間がかかるかも．
- 画像を全て読み込んだのを確認してからゲーム画面に移るので，何かが原因で画像が読み込めなかったら永遠にゲーム画面に到達しないかも．
- 画面遷移や登場，ゲームスタートなどのボタンを連打すると変な動作をするかも．
- 複数人が同じサンタを選んだ場合，合計で振った数がそのままサンタの上り動作に反映される．
- 1frame毎の移動ピクセル数を少なくして，大人数で競うのもいいかも．
- 難易度は甘めに設定しているつもり，気になる人は管理画面，サンタの動き調整，1frame毎の移動ピクセル数を調整して下さい．
- 調整の仕方は数字を入力して，反映ボタンを押す．
- 画面が大きい場合は拡大縮小などして調整して下さい．


# ガジェット版
- 192.168.11.xxx でーカルネットワークを作成し、無線LANにノートPCを接続し、固定IP192.168.11.3を設定
- アンドロイド端末を無線LANに接続する。
- アンドロイド端末は、「シャッター：画面回転なし」「開発者オプション：充電中にスリープにしない、USBデバッグ」「bluetooth: on」「セキュリティ：開発元不明のアプリをインストール」にしておく
- mng.apk、cmp.apk、app.apkをアンドロイド端末にインストール
- wearableフォルダをアンドロイド端末のDCIMとかMusicがあるフォルダにコピー
- アンドロイド端末で「リストデバイス部品」アプリを起動し、ガジェットの裏に書いた数字を入力する
- ガジェットの電源を入れ、サブスクライブボタンを押す
- ガジェットが震え、アンドロイドの画面に「wrist-030と接続されました」と表示が出れば成功
- connect ボタンを押してサーバに接続する
- アンドロイド端末は一度でもスリープしたら復旧しないので、家ボタン長押しからアプリを再起動する。
